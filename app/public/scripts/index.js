const format=d3.format(",d"),width=932,radius=932/6,arc=d3.arc().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(1.5*radius).innerRadius(t=>t.y0*radius).outerRadius(t=>Math.max(t.y0*radius,t.y1*radius-1)),partition=t=>{const e=d3.hierarchy(t).sum(t=>t.size).sort((t,e)=>e.value-t.value);return d3.partition().size([2*Math.PI,e.height+1])(e)},{require:require}=new observablehq.Library;require()("@observablehq/flare").then(t=>{console.log(t);const e=partition(t),r=d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow,t.children.length+1));e.each(t=>t.current=t);const a=d3.select("#partitionSVG").style("width","100%").style("height","auto").style("font","10px sans-serif").append("g").attr("transform","translate(466,466)"),n=a.append("g").selectAll("path").data(e.descendants().slice(1)).join("path").attr("fill",t=>{for(;t.depth>1;)t=t.parent;return r(t.data.name)}).attr("fill-opacity",t=>s(t.current)?t.children?.6:.4:0).attr("d",t=>arc(t.current));n.filter(t=>t.children).style("cursor","pointer").on("click",o),n.append("title").text(t=>`${t.ancestors().map(t=>t.data.name).reverse().join("/")}\n${format(t.value)}`);const i=a.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").selectAll("text").data(e.descendants().slice(1)).join("text").attr("dy","0.35em").attr("fill-opacity",t=>+c(t.current)).attr("transform",t=>d(t.current)).text(t=>t.data.name),l=a.append("circle").datum(e).attr("r",radius).attr("fill","none").attr("pointer-events","all").on("click",o);function o(t){l.datum(t.parent||e),e.each(e=>e.target={x0:2*Math.max(0,Math.min(1,(e.x0-t.x0)/(t.x1-t.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(e.x1-t.x0)/(t.x1-t.x0)))*Math.PI,y0:Math.max(0,e.y0-t.depth),y1:Math.max(0,e.y1-t.depth)});const r=a.transition().duration(750);n.transition(r).tween("data",t=>{const e=d3.interpolate(t.current,t.target);return r=>t.current=e(r)}).filter(function(t){return+this.getAttribute("fill-opacity")||s(t.target)}).attr("fill-opacity",t=>s(t.target)?t.children?.6:.4:0).attrTween("d",t=>()=>arc(t.current)),i.filter(function(t){return+this.getAttribute("fill-opacity")||c(t.target)}).transition(r).attr("fill-opacity",t=>+c(t.target)).attrTween("transform",t=>()=>d(t.current))}function s(t){return t.y1<=3&&t.y0>=1&&t.x1>t.x0}function c(t){return t.y1<=3&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.03}function d(t){const e=(t.x0+t.x1)/2*180/Math.PI;return`rotate(${e-90}) translate(${(t.y0+t.y1)/2*radius},0) rotate(${e<180?0:180})`}});